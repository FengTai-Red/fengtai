<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>风台</title>
    <meta name="description" content="风台的个人网站">
    <meta name="keyworks" content="风台">
    <link rel="shortcut icon" href="image/base/favicon.ico">
    <link rel="stylesheet" href="css/article.css">
</head>

<body>
    <script type="text/javascript" src="js/head.js"></script>
    
    <div class="live2D">
        <!-- 偷来的看板娘 -->
        <script type="text/javascript" charset="utf-8" src="js/L2Dwidget.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/L2Dwidget.0.min.js"></script>
        <script type="text/javascript">
        L2Dwidget.init({"display": {
            "superSample": 2,
            "width": 200,
            "height": 400,
            "position": "right",
            "hOffset": 100,
            "vOffset": 100
            }
        });
        </script>
    </div>
    <div class="article">
        <!-- 文章 -->
        <img class="bg" src="image/gallery/16.jpg" alt="">
        <h3 class="title">TomCat的使用</h3>
        <h6 class="snapshot">
            算是正式步入Web的门了吧，然而毕竟是用VS Code写代码的，和教学的老师用的IDE不一样，所以配置过程中遇到了许多问题。
        </h6>
        <p class="time">2020/09/10</p>

        <h4 class="passage">JavaWeb概念</h4>
        <p class="letterpress">Java web，是用java技术来解决相关web互联网领域的技术的总称。web包括：web服务器和web客户端两部分。</p>
        <p class="letterpress">java在最早web客户端的应用有java applet程序，不过这种技术在很久之前就已经被淘汰了。java在服务器端的应用非常丰富，比如Servlet，jsp和第三方框架等等。java技术对web领域的发展注入了强大的动力。</p>
        <p class="letterpress">javaweb开发是基于请求和响应的:</p>
        <p class="letterpress">请求：浏览器（客户端）向服务器发送信息</p>
        <p class="letterpress">响应：服务器向（客户端）浏览器回送信息</p>
        <p class="letterpress">Web服务器一般指网站服务器，是指驻留于因特网上某种类型计算机的程序，可以处理浏览器等Web客户端的请求并返回相应响应，也可以放置网站文件，让全世界浏览；可以放置数据文件，让全世界下载。</p>
        
        <h4 class="passage">Tomcat服务器</h4>
        <p class="letterpress">开源小型web服务器 ，完全免费，主要用于中小型web项目，只支持Servlet和JSP 等少量javaee规范（就是JavaWeb编程接口）</p>
        
        <h4 class="passage">java文件的编写</h4>
        <p class="letterpress">1.创建普通的java类并继承HttpServlet</p>
        <p class="letterpress">2.复写service方法</p>
        <p class="letterpress">3.在service方法中书写逻辑代码</p>
        <div class="code_box">
            <p class="code">package S619Test;</p>
            <p class="code">import java.io.IOException;</p>
            <p class="code">import javax.servlet.ServletException;</p>
            <p class="code">import javax.servlet.http.HttpServlet;</p>
            <p class="code">import javax.servlet.http.HttpServletRequest;</p>
            <p class="code">import javax.servlet.http.HttpServletResponse;</p>
            <p class="code">public class S619App extends HttpServlet{</p>
            <p class="code">    @Override</p>
            <p class="code">    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {</p>
            <p class="code">        resp.getWriter().write("this is my first servlet.");</p>
            <p class="code">        System.out.println("this is my first servlet.");</p>
            <p class="code">    }</p>
            <p class="code">}</p>
        </div>
        <p class="letterpress">浏览器发送请求到服务器，服务器根据请求URL地址中的URI信息在webapps目录下找到对应的项目文件夹，然后在web.xml中检索对应的servlet，找到后调用并执行servlet</p>
        <p class="letterpress">URL：http:localhost:端口号/虚拟项目名/servlet的别名</p>

        <h4 class="passage">tomcat配置</h4>
        <p class="letterpress">tomcat目录结构图</p>
        <img style="display: block; width: 80%; margin: 0 auto;" src="image/article/16/tomcat.png" alt="">
        <p class="letterpress">1.首先就是下载jdk和tomcat，安装好并配置好环境</p>
        <p class="letterpress">2.进入安装好后的tomcat文件夹下的"\webapps\myapp"目录下，新建一个项目文件夹，名字自定义，这里取"myapp"</p>
        <p class="letterpress">3.进入刚刚新建的文件夹"myapp"中，新建一个名为"WEB-INF"的文件夹</p>
        <p class="letterpress">4.进入刚刚新建的文件夹"WEB-INF"中，新建一个名为"classes"的文件夹</p>
        <p class="letterpress">5.将编译后的.class字节码文件拷贝到"classes"文件夹中，连文件夹一起拷贝，即bin目录下的文件夹</p>
        <p class="letterpress">6.在"WEB-INF"文件夹下新建一个名为"web.xml"的文件，基础配置如下：</p>
        <div class="code_box">
            <p class="code">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p>
            <p class="code">&lt;web-app xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" version="2.5"&gt;</p>
            <p class="code">&nbsp;</p>
            <p class="code">    &lt;servlet&gt;</p>
            <p class="code">        &lt;servlet-name&gt;S619&lt;/servlet-name&gt;</p>
            <p class="code">        &lt;servlet-class&gt;S619App.S619Test.S619&lt;/servlet-class&gt;</p>
            <p class="code">    &lt;/servlet&gt;</p>
            <p class="code">    &lt;servlet-mapping&gt;</p>
            <p class="code">        &lt;servlet-name&gt;S619&lt;/servlet-name&gt;</p>
            <p class="code">        &lt;url-pattern&gt;/S619&lt;/url-pattern&gt;</p>
            <p class="code">    &lt;/servlet-mapping&gt;</p>
            <p class="code">&nbsp;</p>
            <p class="code">    &lt;servlet&gt;</p>
            <p class="code">        &lt;servlet-name&gt;S621UserServlet&lt;/servlet-name&gt;</p>
            <p class="code">        &lt;servlet-class&gt;S619App.S621Servlet.S621UserServlet&lt;/servlet-class&gt;</p>
            <p class="code">    &lt;/servlet&gt;</p>
            <p class="code">    &lt;servlet-mapping&gt;</p>
            <p class="code">        &lt;servlet-name&gt;S621UserServlet&lt;/servlet-name&gt;</p>
            <p class="code">        &lt;url-pattern&gt;/S621UserServlet&lt;/url-pattern&gt;</p>
            <p class="code">    &lt;/servlet-mapping&gt;</p>
            <p class="code">&nbsp;</p>
            <p class="code">&lt;/web-app&gt;</p>
        </div>
        <p class="letterpress">其中servlet-name为其中servlet的名称，servlet与servlet-mapping的servlet-name要相同</p>
        <p class="letterpress">servlet-class为类的路径，需为包含包名的路径</p>
        <p class="letterpress">url-pattern为URL</p>
        <p class="letterpress">完成后目录结构如下</p>
        <div class="code_box">
            <p class="code">webapps</p>
            <p class="code">-myapp</p>
            <p class="code">--index.jsp</p>
            <p class="code">---web.xml</p>
            <p class="code">---WEB-INF</p>
            <p class="code">----classes</p>
            <p class="code">-----S619App</p>
            <p class="code">------S619Test</p>
            <p class="code">-------S619.class</p>
            <p class="code">------S621Servlet</p>
            <p class="code">-------S621UserServlet.class</p>
        </div>
        <p class="letterpress">运行/bin/startup.bat，在浏览器地址栏输入"http://localhost:8080/myapp/S619"就可以访问页面了</p>

        <h4 class="passage">常见错误</h4>
        <p class="letterpress">startup.bat出现乱码</p>
        <p class="letterpress">原因:字节流解码为字符串时，使用了错误的字符集（和编码所用字符集不一致）</p>
        <p class="letterpress">1.记事本打开/conf/logging.properties</p>
        <p class="letterpress">2.找到:找到如下配置项：java.util.logging.ConsoleHandler.encoding = UTF-8</p>
        <p class="letterpress">3.将 UTF-8 修改为 GBK，修改后的效果为：java.util.logging.ConsoleHandler.encoding = GBK</p>
        <p class="letterpress">网页乱码</p>
        <p class="letterpress">对于java文件，在service方法开头加上：</p>
        <div class="code_box">
            <p class="code">req.setCharacterEncoding("UTF-8");</p>
            <p class="code">resp.setContentType("text/html;charset=UTF-8");</p>
        </div>
        <p class="letterpress">对于jsp文件乱码，在jsp开头加上</p>
        <div class="code_box">
            <p class="code"><%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%></p>
        </div>
        
        <h4 class="passage">使用python加载文件及启动服务</h4>
        <p class="letterpress">教学的老师是使用eclipse的，可以安装插件很方便的加载Tomcat服务。然而我用的时VSCode，每次都要手动复制文件，启动服务器，是一件很麻烦的事情。虽然VSCode也有相关的插件，但我用不来，只好自己写一个简单的了，这种情况一般用python来解决。</p>
        <p class="letterpress">需要用到以下库</p>
        <p class="letterpress">tkinter ：图形开发界面，方便操作</p>
        <p class="letterpress">shutil 和 os ：用于复制文件</p>
        <p class="letterpress">win32api ：用于启动服务器</p>
        <p class="letterpress">代码如下，由于是个人使用，因此耦合性很弱，基本就是自己能用了</p>
        <div class="code_box">
            <p class="code">import shutil</p>
            <p class="code">import os</p>
            <p class="code">import tkinter as tk</p>
            <p class="code">import win32api</p>
            <p class="code"></p>
            <p class="code">class Application(tk.Frame):</p>
            <p class="code"></p>
            <p class="code">    def __init__(self, master = None):</p>
            <p class="code">        super().__init__(master)</p>
            <p class="code">        self.project_name = "S630Ajax"</p>
            <p class="code">        self.java_project_dir = r"D:\File\Java\SXT\07"</p>
            <p class="code">        self.tomcat_project_dir = r"D:\File\Java\Tomacat\apache-tomcat-9.0.37"</p>
            <p class="code">        self.master = master</p>
            <p class="code">        self.pack()</p>
            <p class="code">        self.create_widget()</p>
            <p class="code"></p>
            <p class="code">    def create_widget(self):</p>
            <p class="code">        """</p>
            <p class="code">        定义按钮</p>
            <p class="code">        """</p>
            <p class="code">        self.btn01 = tk.Button(root, text = "启动服务", width = 7, height = 2, command = self.startup)</p>
            <p class="code">        self.btn02 = tk.Button(root, text = "停止服务", width = 7, height = 2, command = self.shutdown)</p>
            <p class="code">        self.btn03 = tk.Button(root, text = "加载文件", width = 7, height = 2, command = self.load_file)</p>
            <p class="code">        self.btn01.pack(side = "left", padx = "10")</p>
            <p class="code">        self.btn02.pack(side = "left", padx = "10")</p>
            <p class="code">        self.btn03.pack(side = "left", padx = "10")</p>
            <p class="code"></p>
            <p class="code">    def startup(self):</p>
            <p class="code">        """</p>
            <p class="code">        开启服务</p>
            <p class="code">        """</p>
            <p class="code">        file_path = self.tomcat_project_dir + r'\bin\startup.bat'</p>
            <p class="code">        result = win32api.ShellExecute(0, 'open', file_path, '', '', 0)</p>
            <p class="code">        if (result &gt; 32):</p>
            <p class="code">            print("服务启动:" + str(result))</p>
            <p class="code"></p>
            <p class="code">    def shutdown(self):</p>
            <p class="code">        """</p>
            <p class="code">        停止服务</p>
            <p class="code">        """</p>
            <p class="code">        file_path = self.tomcat_project_dir + r'\bin\shutdown.bat'</p>
            <p class="code">        result= win32api.ShellExecute(0, 'open', file_path, '', '', 0)</p>
            <p class="code">        if (result &gt; 32):</p>
            <p class="code">            print("服务关闭:" + str(result))</p>
            <p class="code"></p>
            <p class="code">    def load_file(self):</p>
            <p class="code">        """</p>
            <p class="code">        导入文件</p>
            <p class="code">        """</p>
            <p class="code">        pass</p>
            <p class="code">        # self.load_xml_file()</p>
            <p class="code">        self.load_class_file()</p>
            <p class="code">        self.load_web_file()</p>
            <p class="code"></p>
            <p class="code">    def load_xml_file(self):</p>
            <p class="code">        """</p>
            <p class="code">        导入web.xml文件</p>
            <p class="code">        """</p>
            <p class="code">        print(self.project_name)</p>
            <p class="code">        file_source_directory = self.java_project_dir + "\src\{0}\web.xml".format(self.project_name)</p>
            <p class="code">        file_destination_directory = r"D:\File\Java\Tomacat\apache-tomcat-9.0.37\webapps\FengTai\WEB-INF"</p>
            <p class="code">        shutil.copy(file_source_directory, file_destination_directory)</p>
            <p class="code"></p>
            <p class="code">    def load_class_file(self):</p>
            <p class="code">        """</p>
            <p class="code">        导入class文件</p>
            <p class="code">        """</p>
            <p class="code">        file_source_directory = self.java_project_dir + "\\bin\{0}".format(self.project_name)</p>
            <p class="code">        file_destination_directory = self.tomcat_project_dir + "\webapps\FengTai\WEB-INF\classes\{0}".format(self.project_name)</p>
            <p class="code">        file_type = ["class"]</p>
            <p class="code">        self.getDirAndCopyFile(file_source_directory, file_destination_directory, file_type)</p>
            <p class="code"></p>
            <p class="code">    def load_web_file(self):</p>
            <p class="code">        """</p>
            <p class="code">        导入Web文件</p>
            <p class="code">        """</p>
            <p class="code">        file_source_directory = self.java_project_dir + "\src\{0}".format(self.project_name)</p>
            <p class="code">        file_destination_directory = self.tomcat_project_dir + "\webapps\FengTai\{0}".format(self.project_name)</p>
            <p class="code">        file_type = ["jsp", "css", "js", "jpg", "ico", "png", "gif"]</p>
            <p class="code">        self.getDirAndCopyFile(file_source_directory, file_destination_directory, file_type)</p>
            <p class="code"></p>
            <p class="code">    def getDirAndCopyFile(self, sourcePath,targetPath,file_type):</p>
            <p class="code">        """</p>
            <p class="code">        利用递归实现目录的遍历</p>
            <p class="code">        @para sourcePath:原文件目录</p>
            <p class="code">        @para targetPath:目标文件目录</p>
            <p class="code">        """</p>
            <p class="code">        if not os.path.exists(sourcePath):</p>
            <p class="code">            return</p>
            <p class="code">        if not os.path.exists(targetPath):</p>
            <p class="code">            os.makedirs(targetPath)</p>
            <p class="code">        for fileName in os.listdir(sourcePath):</p>
            <p class="code">            absourcePath = os.path.join(sourcePath, fileName)</p>
            <p class="code">            abstargetPath = os.path.join(targetPath, fileName)</p>
            <p class="code">            if os.path.isdir(absourcePath):</p>
            <p class="code">                if (not os.path.exists(absourcePath)):</p>
            <p class="code">                    os.makedirs(abstargetPath)</p>
            <p class="code">                self.getDirAndCopyFile(absourcePath, abstargetPath, file_type)</p>
            <p class="code">            if os.path.isfile(absourcePath) and (absourcePath.split(".")[-1] in file_type):</p>
            <p class="code">                print("复制文件:" + absourcePath)</p>
            <p class="code">                rbf = open(absourcePath, "rb")</p>
            <p class="code">                wbf = open(abstargetPath, "wb")</p>
            <p class="code">                while True:</p>
            <p class="code">                    content = rbf.readline(1024*1024)</p>
            <p class="code">                    if len(content)==0:</p>
            <p class="code">                        break</p>
            <p class="code">                    wbf.write(content)</p>
            <p class="code">                    wbf.flush()</p>
            <p class="code">                rbf.close()</p>
            <p class="code">                wbf.close()</p>
            <p class="code"></p>
            <p class="code">if __name__ == "__main__":</p>
            <p class="code">    root = tk.Tk()</p>
            <p class="code">    root.geometry("240x50+1110+640")  # 窗口大小(长*宽+距离屏幕左边+距离屏幕上边)</p>
            <p class="code">    root.title("Tomcat")  # 标题</p>
            <p class="code">    app = Application(master = root)</p>
            <p class="code">    root.mainloop()</p>
        </div>
    </div>
</body>
</html>
